<div class="institutos-container">
  <div class="header">
    <h1 class="title">ğŸ¥ GestiÃ³n de Institutos</h1>
    <p class="subtitle">Administra y visualiza todos los centros de salud del sistema</p>
  </div>

  <!-- Filtros y controles -->
  <div class="filters-section">
    <div class="filters-grid">
      <!-- Filtro por nombre -->
      <div class="filter-group">
        <label for="filtroInstituto" class="filter-label">Buscar por nombre:</label>
        <input 
          id="filtroInstituto"
          type="text" 
          [(ngModel)]="filtroNombre" 
          placeholder="Escribe el nombre del instituto..."
          class="filter-input">
      </div>
    </div>

    <!-- Botones de control -->
    <div class="controls">
      <button (click)="limpiarFiltros()" class="btn-secondary">ğŸ—‘ï¸ Limpiar filtros</button>
      <button (click)="abrirModalCreacion()" class="btn-success">â• Crear Instituto</button>
      <button (click)="recargar()" class="btn-primary" [disabled]="loading">
        <span *ngIf="loading">ğŸ”„ Cargando...</span>
        <span *ngIf="!loading">ğŸ”„ Recargar</span>
      </button>
    </div>
  </div>

  <!-- EstadÃ­sticas -->
  <div class="stats" *ngIf="!loading && !error">
    <div class="stat-card">
      <span class="stat-number">{{ institutos.length }}</span>
      <span class="stat-label">Total de institutos</span>
    </div>
    <div class="stat-card">
      <span class="stat-number">{{ institutosFiltrados.length }}</span>
      <span class="stat-label">Institutos mostrados</span>
    </div>
  </div>

  <!-- Estados de carga y error -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando institutos...</p>
  </div>

  <div *ngIf="error" class="error-state">
    <div class="error-icon">âš ï¸</div>
    <h3>Error al cargar institutos</h3>
    <p>{{ error }}</p>
    <button (click)="recargar()" class="btn-primary">Intentar de nuevo</button>
  </div>

  <!-- Lista de institutos -->
  <div *ngIf="!loading && !error" class="institutos-grid">
    <div *ngIf="institutosFiltrados.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ¥</div>
      <h3>No se encontraron institutos</h3>
      <p>No hay institutos que coincidan con los filtros seleccionados.</p>
    </div>

    <!-- Tarjetas de institutos -->
    <div *ngFor="let instituto of institutosFiltrados" class="instituto-card">
      <div class="instituto-header">
        <div class="instituto-avatar">
          {{ instituto.nombre.charAt(0).toUpperCase() }}
        </div>
        <div class="instituto-info">
          <h3 class="instituto-nombre">{{ instituto.nombre }}</h3>
          <p class="instituto-id">ID: {{ instituto.id_centro }}</p>
        </div>
        <div class="instituto-badges">
          <span class="badge badge-area">Ãrea {{ instituto.id_area }}</span>
        </div>
      </div>

      <div class="instituto-details">
        <div class="detail-row" *ngIf="instituto.direccion">
          <span class="detail-label">ğŸ“ DirecciÃ³n:</span>
          <span class="detail-value">{{ instituto.direccion }}</span>
        </div>
        
        <div class="detail-row" *ngIf="instituto.telefono">
          <span class="detail-label">ğŸ“ TelÃ©fono:</span>
          <span class="detail-value">{{ instituto.telefono }}</span>
        </div>
        
        <div class="detail-row" *ngIf="instituto.email">
          <span class="detail-label">ğŸ“§ Email:</span>
          <span class="detail-value">{{ instituto.email }}</span>
        </div>

        <div class="detail-row">
          <span class="detail-label">ğŸ¥ ID Ãrea:</span>
          <span class="detail-value">{{ instituto.id_area }}</span>
        </div>
      </div>

      <!-- Acciones -->
      <div class="instituto-actions">
        <button (click)="editarInstituto(instituto)" class="btn-action btn-edit" title="Editar instituto">
          âœï¸ Editar
        </button>
        <button 
          (click)="eliminarInstituto(instituto)" 
          class="btn-action btn-delete" 
          [disabled]="estaEliminando(instituto.id_centro)"
          title="Eliminar instituto">
          <span *ngIf="!estaEliminando(instituto.id_centro)">ğŸ—‘ï¸ Eliminar</span>
          <span *ngIf="estaEliminando(instituto.id_centro)">ğŸ”„ Eliminando...</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de EdiciÃ³n de Instituto -->
<div *ngIf="mostrarModalEdicion" class="modal-overlay" (click)="cerrarModalEdicion()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>âœï¸ Editar Instituto</h2>
      <button (click)="cerrarModalEdicion()" class="modal-close">âœ•</button>
    </div>

    <div class="modal-body">
      <!-- InformaciÃ³n del Instituto -->
      <div *ngIf="institutoEditando" class="instituto-info-modal">
        <div class="info-row">
          <span class="info-label">ğŸ¥ Nombre:</span>
          <span class="info-value">{{ institutoEditando.nombre }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">ğŸ†” ID Centro:</span>
          <span class="info-value">{{ institutoEditando.id_centro }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">ğŸ¢ Ãrea:</span>
          <span class="info-value">{{ institutoEditando.id_area }}</span>
        </div>
      </div>

      <div class="form-section">
        <h3>Campos editables</h3>

        <form *ngIf="institutoEditando" class="instituto-form">
          <div class="form-group">
            <label for="nombreInstituto">ğŸ¥ Nombre del Instituto:</label>
            <input
              id="nombreInstituto"
              type="text"
              [(ngModel)]="institutoEditando.nombre"
              name="nombre"
              class="form-input"
              placeholder="Nombre del instituto"
              required>
          </div>

          <div class="form-group">
            <label for="direccionInstituto">ğŸ“ DirecciÃ³n:</label>
            <textarea
              id="direccionInstituto"
              [(ngModel)]="institutoEditando.direccion"
              name="direccion"
              class="form-textarea"
              placeholder="DirecciÃ³n completa del instituto"
              rows="3"></textarea>
          </div>

          <div class="form-group">
            <label for="telefonoInstituto">ğŸ“ TelÃ©fono:</label>
            <input
              id="telefonoInstituto"
              type="tel"
              [(ngModel)]="institutoEditando.telefono"
              name="telefono"
              class="form-input"
              placeholder="NÃºmero de telÃ©fono">
          </div>

          <div class="form-group">
            <label for="emailInstituto">ğŸ“§ Email:</label>
            <input
              id="emailInstituto"
              type="email"
              [(ngModel)]="institutoEditando.email"
              name="email"
              class="form-input"
              placeholder="Correo electrÃ³nico">
          </div>

          <div class="form-group">
            <label for="areaInstituto">ğŸ¢ ID Ãrea:</label>
            <input
              id="areaInstituto"
              type="number"
              [(ngModel)]="institutoEditando.id_area"
              name="id_area"
              class="form-input"
              placeholder="ID del Ã¡rea"
              min="1"
              required>
          </div>

          <!-- Mensaje de error -->
          <div *ngIf="errorEdicion" class="error-message">
            âŒ {{ errorEdicion }}
          </div>
        </form>
      </div>
    </div>

    <div class="modal-footer">
      <button 
        (click)="cerrarModalEdicion()" 
        class="btn-secondary" 
        [disabled]="loadingEdicion">
        ğŸš« Cancelar
      </button>
      <button 
        (click)="guardarCambiosInstituto()" 
        class="btn-primary" 
        [disabled]="loadingEdicion">
        <span *ngIf="!loadingEdicion">ğŸ’¾ Guardar Cambios</span>
        <span *ngIf="loadingEdicion">ğŸ”„ Guardando...</span>
      </button>
    </div>
  </div>
</div>

<!-- Modal de CreaciÃ³n de Instituto -->
<div *ngIf="mostrarModalCreacion" class="modal-overlay" (click)="cerrarModalCreacion()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>â• Crear Nuevo Instituto</h2>
      <button (click)="cerrarModalCreacion()" class="modal-close">âœ•</button>
    </div>

    <div class="modal-body">
      <div class="form-section">
        <h3>InformaciÃ³n del nuevo instituto</h3>

        <form class="instituto-form">
          <div class="form-group">
            <label for="nombreNuevoInstituto">ğŸ¥ Nombre del Instituto: *</label>
            <input
              id="nombreNuevoInstituto"
              type="text"
              [(ngModel)]="nuevoInstituto.nombre"
              name="nombre"
              class="form-input"
              placeholder="Nombre del instituto"
              required>
          </div>

          <div class="form-group">
            <label for="areaNuevoInstituto">ğŸ¢ ID Ãrea:</label>
            <input
              id="areaNuevoInstituto"
              type="number"
              [(ngModel)]="nuevoInstituto.id_area"
              name="id_area"
              class="form-input"
              placeholder="ID del Ã¡rea"
              min="1">
          </div>

          <div class="form-group">
            <label for="direccionNuevoInstituto">ğŸ“ DirecciÃ³n:</label>
            <textarea
              id="direccionNuevoInstituto"
              [(ngModel)]="nuevoInstituto.direccion"
              name="direccion"
              class="form-textarea"
              placeholder="DirecciÃ³n completa del instituto"
              rows="3"></textarea>
          </div>

          <div class="form-group">
            <label for="telefonoNuevoInstituto">ğŸ“ TelÃ©fono:</label>
            <input
              id="telefonoNuevoInstituto"
              type="tel"
              [(ngModel)]="nuevoInstituto.telefono"
              name="telefono"
              class="form-input"
              placeholder="NÃºmero de telÃ©fono">
          </div>

          <div class="form-group">
            <label for="emailNuevoInstituto">ğŸ“§ Email:</label>
            <input
              id="emailNuevoInstituto"
              type="email"
              [(ngModel)]="nuevoInstituto.email"
              name="email"
              class="form-input"
              placeholder="Correo electrÃ³nico">
          </div>

          <!-- Mensaje de error -->
          <div *ngIf="errorCreacion" class="error-message">
            âŒ {{ errorCreacion }}
          </div>
        </form>
      </div>
    </div>

    <div class="modal-footer">
      <button 
        (click)="cerrarModalCreacion()" 
        class="btn-secondary" 
        [disabled]="loadingCreacion">
        ğŸš« Cancelar
      </button>
      <button 
        (click)="crearInstituto()" 
        class="btn-success" 
        [disabled]="loadingCreacion || !nuevoInstituto.nombre.trim()">
        <span *ngIf="!loadingCreacion">â• Crear Instituto</span>
        <span *ngIf="loadingCreacion">ğŸ”„ Creando...</span>
      </button>
    </div>
  </div>
</div>
